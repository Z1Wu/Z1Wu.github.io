<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Service-Computing-06 - Z1Wu&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="z1wu" />
  <meta name="description" content="ServiceComputing homework&amp;ndash;Docker初探 本文主要关注如何在 window10 专业版下安装 dockers，和相关的配置以及简单的使用。 安装 从官网下载 docker" />







<meta name="generator" content="Hugo 0.48" />


<link rel="canonical" href="http://z1wu.github.io/post/service_computing_6/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Service-Computing-06" />
<meta property="og:description" content="ServiceComputing homework&ndash;Docker初探 本文主要关注如何在 window10 专业版下安装 dockers，和相关的配置以及简单的使用。 安装 从官网下载 docker" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://z1wu.github.io/post/service_computing_6/" /><meta property="article:published_time" content="2018-12-20T12:58:43&#43;08:00"/>
<meta property="article:modified_time" content="2018-12-20T12:58:43&#43;08:00"/>
<meta itemprop="name" content="Service-Computing-06">
<meta itemprop="description" content="ServiceComputing homework&ndash;Docker初探 本文主要关注如何在 window10 专业版下安装 dockers，和相关的配置以及简单的使用。 安装 从官网下载 docker">


<meta itemprop="datePublished" content="2018-12-20T12:58:43&#43;08:00" />
<meta itemprop="dateModified" content="2018-12-20T12:58:43&#43;08:00" />
<meta itemprop="wordCount" content="1687">



<meta itemprop="keywords" content="Service-Computing,Docker," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Service-Computing-06"/>
<meta name="twitter:description" content="ServiceComputing homework&ndash;Docker初探 本文主要关注如何在 window10 专业版下安装 dockers，和相关的配置以及简单的使用。 安装 从官网下载 docker"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Z1Wu&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Z1Wu&#39;s blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Service-Computing-06</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-12-20 </span>
        
        <span class="more-meta"> 1687 words </span>
        <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#servicecomputing-homework-docker初探">ServiceComputing homework&ndash;Docker初探</a>
<ul>
<li><a href="#安装">安装</a>
<ul>
<li><a href="#从官网下载-docker">从官网下载 docker</a></li>
<li><a href="#安装流程">安装流程</a></li>
</ul></li>
<li><a href="#配置">配置</a>
<ul>
<li><a href="#处理-docker-pull-的问题">处理 docker pull 的问题</a>
<ul>
<li><a href="#把默认的源设置成国内的镜像">把默认的源设置成国内的镜像</a></li>
<li><a href="#设置代理">设置代理</a></li>
</ul></li>
<li><a href="#搭建前端镜像">搭建前端镜像</a>
<ul>
<li><a href="#创建-dockerfile">创建 Dockerfile</a></li>
<li><a href="#通过-dockerfile-创建镜像">通过 Dockerfile 创建镜像</a></li>
<li><a href="#运行容器">运行容器</a></li>
</ul></li>
</ul></li>
<li><a href="#参考">参考</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<h1 id="servicecomputing-homework-docker初探">ServiceComputing homework&ndash;Docker初探</h1>

<p>本文主要关注如何在 window10 专业版下安装 dockers，和相关的配置以及简单的使用。</p>

<h2 id="安装">安装</h2>

<h3 id="从官网下载-docker">从官网下载 docker</h3>

<h3 id="安装流程">安装流程</h3>

<ol>
<li><p>按照官网给的教程，在 win10 pro 的环境下，应该首先打开 <code>hyper-v</code>(注意：打开 <code>hyper-v</code> 之后，如果不添加其他设置的话，android studio 中的虚拟机是无法打开的，原因暂时不太明白【猜测可能是和虚拟化方式的改变有关】)</p></li>

<li><p>按照下载得到的 installer 的指示，完成安装即可。【没有截图。。。】</p></li>
</ol>

<h2 id="配置">配置</h2>

<h3 id="处理-docker-pull-的问题">处理 docker pull 的问题</h3>

<p>由于docker默认的源是在国外的，使用docker下载源上的 image 在默认情况下是无法完成的，一般会出现的错误都是访问超时，这种情况下有两种解决方法：</p>

<h4 id="把默认的源设置成国内的镜像">把默认的源设置成国内的镜像</h4>

<p>本次实验没有按照尝试这个方法，可以自行配置。</p>

<pre><code class="language-shell">
$ docker pull registry.docker-cn.com/myname/myrepo:mytag

</code></pre>

<h4 id="设置代理">设置代理</h4>

<p>由于当前环境使用的ss进行代理，所以考虑设置为 dockers 客户端设置代理，目前使用的Windows，直接在dockers设置中就可以设置代理。</p>

<p><img src="/images/service_computing/6/setup_proxy.png" alt="" /></p>

<h3 id="搭建前端镜像">搭建前端镜像</h3>

<p>这个是本次作业的一部分，顺便可以当成一个练习，实践一下，作业的要求是把上一次作业【swapi】的 web 应用容器化。</p>

<p>没能完全理解在本次作业在前端 docker 的在实际中如何发挥作用，出于练习和作业要求的目的，按照流程把 前端的镜像先搭建起来。</p>

<h4 id="创建-dockerfile">创建 Dockerfile</h4>

<p>根据官网教程的指示，首先应该使用 <code>dockerfile</code> 来创建一个镜像，由于本次实验是第一次接触 <code>vue</code>，不太熟悉，考虑这应该属于常见的应用场景，上<code>vue</code>官网应该能够搜索相关的 <code>dockerfile</code> 作为 starter，果然我们可以在<a href="https://vuejs.org/v2/cookbook/dockerize-vuejs-app.html#ad">官方教程</a>中看到</p>

<pre><code class="language-shell">
# 以下是从官网拉下来的例子

FROM node:9.11.1-alpine

# install simple http server for serving static content
RUN npm install -g http-server

# make the 'app' folder the current working directory
WORKDIR /app

# copy both 'package.json' and 'package-lock.json' (if available)
COPY package*.json ./

# install project dependencies
RUN npm install

# copy project files and folders to the current working directory (i.e. 'app' folder)
COPY . .

# build app for production with minification
RUN npm run build

EXPOSE 8080
CMD [ &quot;http-server&quot;, &quot;dist&quot; ]

</code></pre>

<p>可以看到大致的流程，通过 <code>FROM</code> 基于一个另外一个镜像(image)进行开发，之后就是通过 node 搭建这个项目的过程。</p>

<p>需要注意的是这里使用到了 <code>COPY</code> 命令，把本地的文件移入到容器中，而且使用的是相对路径的写法，所以我们需要把这个 <code>Dcokerfile</code> 放在我们项目的根目录下。</p>

<h4 id="通过-dockerfile-创建镜像">通过 Dockerfile 创建镜像</h4>

<p>在根目录下输入以下命令，其中 -t 指代的是的这个镜像的名字，最后面的 <code>.</code>，指代的是对应的创建镜像的上下文<code>(contxext)</code>, 关于这个上下文对创建镜像的影响，可以参考<a href="https://yeasy.gitbooks.io/docker_practice/content/image/build.html">这里</a></p>

<pre><code class="language-shell">
docker build -t docker build -t my-swapi-vue:v1 .

</code></pre>

<p>如果网络环境良好的话，在这一步，应该就完成了构建。不过一般情况下，是完成不了的。报出的错误应该是 <code>npm request timeout</code> 之类的错误，查看 <code>Dockerfile</code> 可以发现，首先是 <code>From</code> 命令，由于我们已经在上面配置好了客户端的代理，这里应该是可以顺利完成的，但是之后又 <code>npm run install</code>，这个应该就是问题的所在，官网提供的 <code>node</code> 镜像，里面配置的源应该还是外国的源，而在我们构建镜像的时候，流量是不会通过我们 host 机的 shadowsocks 代理的，所以这个 install 应该是不会成功的。</p>

<p>发现问题之后我们可以通过修改 <code>Dockerfile</code> 来避开这个问题。</p>

<pre><code class="language-shell">FROM node:9.11.1-alpine

# install simple http server for serving static content
RUN npm install -g cnpm --registry=https://registry.npm.taobao.org &amp;&amp; cnpm install -g http-server

# make the 'app' folder the current working directory
WORKDIR /app

# copy both 'package.json' and 'package-lock.json' (if available)
COPY package*.json ./

# install project dependencies
# RUN npm install

RUN cnpm install

# copy project files and folders to the current working directory (i.e. 'app' folder)
COPY . .

# build app for production with minification
RUN npm run build

EXPOSE 8080
CMD [ &quot;http-server&quot;, &quot;dist&quot; ]
</code></pre>

<p>可以看到主要的改动在于，修改了 <code>npm</code> 的源，以及之后的包安装操作都使用了<code>cnpm</code>。</p>

<h4 id="运行容器">运行容器</h4>

<pre><code class="language-shell">
docker run -it -p 8080:8080 --rm --name dockerize-vuejs-app-1 my-swapi-vue:v1

</code></pre>

<p>由于上面是开发环境，构建了一个简单的 server, 而且是监听容器的 8080 端口，同时在 Dockefile 里面也指代了容器暴露的端口 <code>expose</code>，所以我们在运行的时候 -p 把 <code>host</code> 上的端口和容器的端口对应起来。</p>

<p>另外还需要注意的是</p>

<ul>
<li><p>-it =&gt; 指代的是 &ndash;interactive 和 &ndash;terminal 也就是保持容器的终端，让我们能和容器进行交互。</p></li>

<li><p>&ndash;name =&gt; 指代的应该是容器的名字。</p></li>

<li><p>&ndash;rm =&gt; 防止命名冲突，删除已经存在的同名container</p></li>

<li><p>最后的应该是指定容器从哪一个镜像中启动。</p></li>
</ul>

<h2 id="参考">参考</h2>

<p>vue 教程：<a href="https://vuejs.org/v2/cookbook/dockerize-vuejs-app.html#ad">https://vuejs.org/v2/cookbook/dockerize-vuejs-app.html#ad</a></p>

<p>docker 官方文档：<a href="https://docs.docker.com/">https://docs.docker.com/</a></p>

<p>docker-pratice：<a href="https://yeasy.gitbooks.io/docker_practice/content/">https://yeasy.gitbooks.io/docker_practice/content/</a></p>

<p>docker-china-mirror：<a href="https://www.docker-cn.com/registry-mirror">https://www.docker-cn.com/registry-mirror</a></p>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">z1wu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2018-12-20</span>
  </p>
  
  
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/service-computing/">Service-Computing</a>
          
          <a href="/tags/docker/">Docker</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/system_analysis_hw1/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">System-Analysis-hw1</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/service_computing_5/">
            <span class="next-text nav-default">Service-Computing-05</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="http://localhost:1313" class="iconfont icon-github" title="github"></a>
  <a href="http://z1wu.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2018 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">z1wu</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>








</body>
</html>
